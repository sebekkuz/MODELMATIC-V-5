import { z } from 'zod';export const TimeHMS=z.string().regex(/^\d{1,2}:\d{2}:\d{2}$/);export const OpType=z.enum(['J','M','MD','MO','P','PAK','PD','PO','PR','R']);export const OperationDef=z.object({name:z.string(),type:OpType,time_s:z.number().nonnegative(),});export const FunctionKey=z.string();export const FamilyKey=z.string();export const SizeKey=z.string();export const Route=z.object({family:FamilyKey,kind:z.enum(['FUNCTION','ENCLOSURE']),key:z.string(),size:SizeKey.optional(),steps:z.array(z.string()),});export const StationID=z.string();export const Station=z.object({id:StationID,name:z.string(),pos:z.object({x:z.number().int().min(0),y:z.number().int().min(0)}),capacity:z.number().int().min(1).default(1),families:z.array(FamilyKey),opTypes:z.array(OpType),operations:z.array(z.string()),bufferMode:z.enum(['info','hard']).default('info'),buffers:z.record(z.string(),z.number().int().min(0)).default({}),});export const Connection=z.object({id:z.string(),from:StationID,to:StationID,name:z.string().default('flow'),travel_s:z.number().nonnegative().default(0),distance_m:z.number().nonnegative().default(0),});export const Worker=z.object({id:z.string(),name:z.string(),speed_mps:z.number().positive(),assignedTo:z.array(StationID).default([]),});export const Tool=z.object({id:z.string(),name:z.string(),speed_mps:z.number().positive(),assignedTo:z.array(StationID).default([]),});export const BufferDef=z.object({id:z.string(),name:z.string(),capacity:z.number().int().min(0),startFor:z.enum(['FUNCTION','ENCLOSURE']),key:z.string()});export const Grid=z.object({cols:z.number().int().positive(),rows:z.number().int().positive()});export const Layout=z.object({grid:Grid,stations:z.array(Station),connections:z.array(Connection)});export const ScenarioOrder=z.object({id:z.string(),dateISO:z.string().optional(),size:SizeKey,sections:z.string(),chosen:z.array(FunctionKey),});export const Scenario=z.object({family:FamilyKey,selected:z.array(FunctionKey),dedupMap:z.record(FunctionKey,z.boolean()).default({}),from:z.string().optional(),to:z.string().optional(),orders:z.array(ScenarioOrder),});export const Project=z.object({version:z.string(),layout:Layout,routes:z.array(Route),buffers:z.array(BufferDef).default([]),people:z.array(Worker).default([]),tools:z.array(Tool).default([]),scenario:Scenario.optional(),});
